type: install
version: 1.9
id: brawlgpt-docker-fixedip
name: BrawlGPT - Docker Compose (Fixed IP)
categories:
  - apps/dev-and-admin-tools
homepage: https://github.com/san2stic/BrawlGPT
logo: https://raw.githubusercontent.com/san2stic/BrawlGPT/main/logo.png
description: |
  AI-powered coaching platform for Brawl Stars players.
  Deployed with Docker Compose and Public Fixed IP.
  
  Tech Stack: FastAPI, React 19, PostgreSQL, Redis

settings:
  fields:
    - type: string
      name: brawlApiKey
      caption: Brawl Stars API Key
      placeholder: Get from developer.brawlstars.com
      required: true
      
    - type: string
      name: openrouterApiKey
      caption: OpenRouter API Key  
      placeholder: Get from openrouter.ai
      required: true
      inputType: password
      
    - type: string
      name: jwtSecret
      caption: JWT Secret Key (32+ chars)
      required: true
      inputType: password
      default: ${fn.password(32)}

nodes:
  - nodeType: docker
    nodeGroup: cp
    displayName: BrawlGPT Application
    count: 1
    fixedCloudlets: 2
    flexibleCloudlets: 16
    extip: true  # ENABLE PUBLIC FIXED IP
    volumes:
      - /var/lib/postgresql/data
      - /var/lib/redis/data

onInstall:
  - log: "Cloning BrawlGPT repository..."
  - cmd[cp]: |-
      cd /root
      rm -rf BrawlGPT
      git clone https://github.com/san2stic/BrawlGPT.git
      cd BrawlGPT
  
  - log: "Creating .env file with Fixed IP configuration..."
  - cmd[cp]: |-
      cd /root/BrawlGPT/backend
      cat > .env <<EOF
      BRAWL_API_KEY=${settings.brawlApiKey}
      OPENROUTER_API_KEY=${settings.openrouterApiKey}
      SECRET_KEY=${settings.jwtSecret}
      DATABASE_URL=postgresql+asyncpg://brawl_user:brawl_password@postgres:5432/brawlgpt_db
      REDIS_URL=redis://redis:6379/0
      ALLOWED_ORIGINS=http://${nodes.cp.extIPs[0]}:3000,https://${nodes.cp.extIPs[0]}:3000,http://${env.domain}:3000,https://${env.domain}:3000
      LOG_LEVEL=INFO
      DEBUG=false
      EOF
      
  - log: "Creating docker-compose override for Fixed IP..."
  - cmd[cp]: |-
      cd /root/BrawlGPT
      cat > docker-compose.override.yml <<EOF
      services:
        backend:
          environment:
            - ALLOWED_ORIGINS=http://${nodes.cp.extIPs[0]}:3000,http://localhost:3000,http://frontend
        
        frontend:
          build:
            args:
              - VITE_API_URL=http://${nodes.cp.extIPs[0]}:8000
      EOF
  
  - log: "Starting Docker Compose..."
  - cmd[cp]: |-
      cd /root/BrawlGPT
      docker compose down || true
      docker compose up -d --build
  
  - log: "Waiting for services to start..."
  - sleep: 45000
  
  - log: "Checking service health..."
  - cmd[cp]: |-
      cd /root/BrawlGPT
      docker compose ps
      echo "=== Backend Logs ==="
      docker compose logs backend --tail 20
  
  - log: "BrawlGPT deployed successfully with Fixed IP!"

success: |
  # ðŸŽ® BrawlGPT Deployed with Fixed IP!
  
  Your application is ready with a **Public Fixed IP Address**!
  
  ## Access Information
  - **Frontend URL**: http://${nodes.cp.extIPs[0]}:3000
  - **Backend API**: http://${nodes.cp.extIPs[0]}:8000
  - **API Docs**: http://${nodes.cp.extIPs[0]}:8000/docs
  - **Health Check**: http://${nodes.cp.extIPs[0]}:8000/health
  
  ## Fixed IP Details
  - **Public IP**: ${nodes.cp.extIPs[0]}
  - **Internal Domain**: ${env.domain}
  
  ## Important Notes
  âš ï¸ **The services may take 2-3 minutes to fully start**
  
  If you encounter issues:
  1. Check logs: Click on your node â†’ "Log" button
  2. Verify services: `docker compose ps` in Web SSH
  3. Check backend health: `curl http://localhost:8000/health`
  
  ## Exposed Ports
  - **3000**: Frontend (React)
  - **8000**: Backend (FastAPI)
  - **5432**: PostgreSQL (for debugging only)
  - **6379**: Redis (for debugging only)
  
  ## Next Steps
  1. Visit http://${nodes.cp.extIPs[0]}:3000
  2. If you see a blank page, wait 1-2 minutes and refresh
  3. Configure your firewall to allow ports 3000 and 8000
  
  ## Support
  - GitHub: https://github.com/san2stic/BrawlGPT
  - Logs: Check Jelastic dashboard â†’ Node â†’ Log
